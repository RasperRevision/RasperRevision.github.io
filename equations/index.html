<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rasper Revision</title>

  <!-- BOOTSTRAP STYLES -->
  <link href="/node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

  <!-- BOOTSTRAP SCRIPTS-->
  <script src="/node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"
    defer></script>

  <!-- BOOTSTRAP ICONS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- STYLES -->
  <link href="/style.css" rel="stylesheet">

  <style>
    body {
      height: 100vh;
    }

    .container {
      max-width: 600px;
      border-radius: 10px;
    }

    .form-control {
      min-height: 41px;
    }
  </style>
</head>

<body class="bg-dark d-flex align-items-center justify-content-center p-0 m-0">
  <div class="container bg-light p-4">
    <div class="alert invis alert-success p-2" style="color: black !important">üó∏ Correct!</div>
    <div class="alert invis alert-danger p-2" style="color: black !important">‚òì Incorrect. Try again</div>
    <div class="equation_question" style="color: black !important"></div>
    <div class="symbol-menu mt-3">
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Mass">m</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Work done">W</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip"
        data-bs-title="Gravitational field strength">g</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Distance">d</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Density">œÅ</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Pressure">P</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Area">A</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Resistance">R</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Energy">E</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Moment">M</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip"
        data-bs-title="Potential Difference">V</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Height">h</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Current">Q</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip"
        data-bs-title="Gravitational potential energy">E‚Çö</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Force">F</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Displacement">s</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Acceleration">a</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Wavelength">Œª</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip"
        data-bs-title="Spring constant">k</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Weight">w</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Extension">e</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Momentum">p</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Current">I</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Time">t</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip" data-bs-title="Frequency">f</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip"
        data-bs-title="Velocity / Wave speed">v</button>
      <button class="btn btn-info symbol-button my-1 text-white" data-bs-toggle="tooltip"
        data-bs-title="Kinetic energy">E‚Çñ</button>
    </div>
    <div class="maths-menu mt-3">
      <button class="btn btn-info text-white maths-button my-1" data-bs-toggle="tooltip"
        data-bs-title="Squared">¬≤</button>
      <button class="btn btn-info text-white maths-button my-1" data-bs-toggle="tooltip"
        data-bs-title="Divided by">√∑</button>
      <button class="btn btn-info text-white maths-button my-1" data-bs-toggle="tooltip"
        data-bs-title="Equals">=</button>
      <button class="btn btn-info text-white maths-button my-1" data-bs-toggle="tooltip"
        data-bs-title="Delta">‚àÜ</button>
      <button class="btn btn-info text-white maths-button my-1" data-bs-toggle="tooltip" data-bs-title="Half">¬Ω</button>
    </div>
    <div class="form-control my-3" style="color: black !important"></div>
    <input type="submit" class="rbtn warning submit_btn">
    <button class="rbtn warning next_btn invis">Next</button>
  </div>

  <script src="/sidebar.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
      
      function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]o]()-=+.$@#%^&*/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"), results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      }

      function loadJSON(callback) {
        var jsonFile = getParameterByName('json');
        var xobj = new XMLHttpRequest();
        xobj.overrideMimeType("application/json");
        xobj.open('GET', jsonFile, true);
        xobj.onreadystatechange = function () {
          if (xobj.readyState == 4 && xobj.status == 200) { callback(JSON.parse(xobj.responseText)); }
        };
        xobj.send(null);
      }

      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      const form = document.querySelector('.form-control');
      const question = document.querySelector('.equation_question');
      const symbol_buttons = document.querySelectorAll('.symbol-button');
      const maths_buttons = document.querySelectorAll('.maths-button');
      const submit = document.querySelector('.submit_btn');
      const next = document.querySelector('.next_btn');
      const success = document.querySelector('.alert-success');
      const danger = document.querySelector('.alert-danger');

      let equations;
      let shuffled;
      let currentEquationIndex = 0;
      let answer;

      function displayEquation() {
        const equationObj = shuffled[currentEquationIndex];
        const parts = equationObj.parts;
        const answers = equationObj.answer;
        question.textContent = 'State the equation linking ' + parts.join(', ');
      }

      symbol_buttons.forEach(function (symbol_button) {
        symbol_button.addEventListener('click', function () {
          form.textContent += symbol_button.textContent;
        });
      });

      maths_buttons.forEach(function (maths_button) {
        maths_button.addEventListener('click', function () {
          form.textContent += maths_button.textContent;
        });
      });

      function nextEquation() {
        currentEquationIndex++;
        if (currentEquationIndex >= shuffled.length) {
          currentEquationIndex = 0;
          shuffled = shuffle([...equations]);
        }
        form.textContent = "";
        displayEquation();
      }


      submit.addEventListener('click', function () {
        const userInput = form.textContent.trim();
        const correctAnswer = shuffled[currentEquationIndex].equation;

        console.log(userInput);
        console.log(correctAnswer);

        if (userInput === correctAnswer) {
          next.classList.remove('invis');
          submit.classList.add('invis');
          success.classList.remove('invis');
        } else {
          danger.classList.remove('invis');
          form.textContent = "";
          setTimeout(function () {
            danger.classList.add('invis');
          }, 5000);
        }
      });


      next.addEventListener('click', function () {
        submit.classList.remove('invis');
        next.classList.add('invis');
        success.classList.add('invis');
        nextEquation();
      })

      loadJSON(function (response) {
        equations = response;
        shuffled = shuffle([...equations]);
        displayEquation();
      });
    });
  </script>
</body>

</html>
